---
layout: default
title: "Middleware"
---

<h1 id="middleware">Middleware</h1>
<p>Middleware allows you to process requests and responses globally before they reach your route handlers. This is useful for tasks like authentication, logging, and error handling.</p>

<h2 id="creating-middleware">Creating Middleware</h2>
<p>A middleware in Xyra is a function that accepts three arguments: <code>request</code>, <code>response</code>, and <code>next_handler</code>.</p>
<pre><code class="language-python">
import time
from xyra import App, Request, Response

app = App()

async def logging_middleware(req: Request, res: Response, next_handler):
    start_time = time.time()
    print(f"Request: {req.method} {req.url}")

    await next_handler(req, res)

    process_time = (time.time() - start_time) * 1000
    print(f"Response: 200 - {process_time:.2f}ms")

app.add_middleware(logging_middleware)

@app.get("/")
def home(req: Request, res: Response):
    res.text("Hello, World!")
</code></pre>
<p>The <code>next_handler</code> is a callable that you must call to pass control to the next middleware or the route handler.</p>

<h2 id="route-specific-middleware">Route-Specific Middleware</h2>
<p>You can also apply middleware to specific routes by passing a list of middleware functions to the route decorator.</p>
<pre><code class="language-python">
async def auth_middleware(req: Request, res: Response, next_handler):
    if "Authorization" not in req.headers:
        res.status(401).json({"error": "Unauthorized"})
        return
    await next_handler(req, res)

@app.get("/protected", middlewares=[auth_middleware])
def protected_route(req: Request, res: Response):
    res.json({"message": "You have access"})
</code></pre>